<html>
  <head>
    <title>do.proje.cx - Do Projects!</title>
    <script type="text/javascript" src="/js/jquery.js"></script>
    
    <script type="text/javascript">
    
      function hide_url_submit_form(urlsubmit_form_element) {
        $(urlsubmit_form_element).children().filter(".scrap_input")[0].value="";
        $(urlsubmit_form_element).parent().css("height","0px").css("visibility", "hidden");
        $(urlsubmit_form_element).parent().siblings().filter(".post_scrap_explanation").css("visibility","visible").css("height","auto");
      }
    
      $(document).ready(function(){
            
        // onmouseover make the post_scrap_explanation div light up
        $(".post_scrap_explanation_span").mouseover(function(event){
          $(this).css("background-color","#ddd");
        }).mouseout(function(event){
          $(this).css("background-color","#fff");
        });
            
        // onclick show the posturl form
        $(".post_scrap_explanation").click(function(event){
          $(this).css("height","0px").css("visibility", "hidden");
          
          var post_scrap_form_div = $(this).siblings().filter(".post_scrap_form_div");
          post_scrap_form_div.css("visibility","visible").css("height","auto");
          
          post_scrap_form_div.children().filter("form").children().filter(".scrap_input").focus();
        });
        
        // onsubmit create scrap via ajax, append response to scraps list, and hide the form
        $(".post_scrap_form").submit(function (event){
          // get data from form
          var content   = $(this).children().filter(".scrap_input")[0].value;
          var projectid = $(this).children().filter(".project_id_input")[0].value;
          
          console.log( content );
          console.log( projectid );
          
          // persist in bigtable
          $.post( "add_scrap/", {'content':content,'projectid':projectid}, function(data,textStatus,xhr){
            console.log( textStatus );
          });
          
          // add the scrap to the current page
          var scrap_list_div = $(this).parent().parent().siblings().filter(".scrap_list");
          scrap_list_div.prepend( $("<div>").html(content) );
          
          // hide the submit form
          hide_url_submit_form($(this));
          
          return false;
        });
        
        // onclick the cancel button, hide the posturl form
        $(".scrap_input_cancel").click(function event(){
          hide_url_submit_form( $(this).parent() );
        });
        
      });
    
    </script>
    
    <style type="text/css">
    
      #userstatus 
        {
           margin-bottom:5px;
           padding:2px;
           overflow:hidden;
           background-color:#ffeeee;
           border-bottom-style:solid;
           border-bottom-width:1px;
           border-bottom-color:#ffbbbb;
           border-right-style:solid;
           border-right-width:1px;
           border-right-color:#ffbbbb;
        }
        
      #header {
           margin-bottom:5px;
           padding:2px;
           overflow:hidden;
           background-color:#eeeeff;
           border-bottom-style:solid;
           border-bottom-width:1px;
           border-bottom-color:#bbbbff;
           border-right-style:solid;
           border-right-width:1px;
           border-right-color:#bbbbff;
      }
        
      #signedin {float:left}
      #logout {float:right}
      #content 
        {
          background-color:#ffffff;
          width:950px;
          display:block;
          margin:auto;
          padding:5px;
          min-height:950px;
        }
      a {text-decoration:none;}
      a:hover {text-decoration:underline}
      body {background-color:#eeeeee}
      h1{margin:0px;padding:5px;}
      
      #addprojectslink{
        background-color:#eeffee;
        text-size:large;
        padding: 2px;
        border-bottom-style:solid;
        border-bottom-width:1px;
        border-bottom-color:#ddffdd;
        border-right-style:solid;
        border-right-width:1px;
        border-right-color:#ddffdd;
      }
      
      #addproject{
        margin-bottom:10px;
      }
      
      #explanation{
        padding: 2px;
      }
      
      .extrainfo {
        padding-left:3px;
        padding-right:3px;
        background-color:#f6f6f6;
      }
      
      ul {
        list-style-type:none;
        padding-left:10px;
      }
      
      .post_scrap_explanation_span {
        font-size: 12px;
        font-style: italic;
        padding:2px;
        color:#888;
      }
      
      .post_scrap_form_div {
        height:0px;
        visibility:hidden;
      }
      
      form {
        margin-bottom:0px;
      }
      
      .project_scraps {
        margin-left:10px;
      }
      
      .scrap_created {
        margin-left:5px;
        font-size:12px;
        color:#888;
      
      }
      
      .scrap_remainder {
        font-size:12px;
        color:#888;
      }
      
      .project_name {
        font-weight:bold;
      }
      
      .scrap_icon {
        margin-right:2px;
      }
      
    </style>
  </head>
  <body>
    <div id="content">
      <div id="userstatus">
        <div id="signedin">
          signed in as <a id="username" href="user/{{user.nickname}}/">{{user}}</a>
        </div>
        <div id="logout">
          <a href="{{signout_url}}">sign out</a>
        </div>
      </div>
      
      <div id="header">
        <h1>
          do.proje.cx
        </h1>
        <div id="explanation">
          do.proje.cx is a place for listing, tracking, and sharing your projects <a class="extrainfo" href="read_more">learn more</a>
        </div>
      </div>

      <div id="addproject">
        <a id="addprojectslink" href="add_project/">add project</a>
      </div>

      <div>
        {% for project in projects %}
        <div>
          <div class="project_summary">
            <span class="project_name"><a href="/project/{{project.id}}/">{{ project.name }}</a></span>
          </div>
          <div class="project_scraps">
            <div class="post_scrap">
              <div class="post_scrap_explanation">
                <span class="post_scrap_explanation_span">click to post a url, a feed url, or a status message</span>
              </div>
              <div class="post_scrap_form_div">
                <form class="post_scrap_form">
                  <input class="scrap_input" size="50" type="text" name="scrap"/>
                  <input class="project_id_input" type="hidden" name="projectid" value="{{project.id}}"/>
                  <input type="submit" value="submit">
                  <input class="scrap_input_cancel" type="button" value="cancel">
                </form>
              </div>
            </div>
            <div class="scrap_list">
              {% for scrap in project.scraps %}
              <div>
                {% ifequal scrap.class_name "LinkScrap" %}
                  <img height=16 width=16 class="scrap_icon" src="{% if scrap.icon %}/scrap_icon/{{scrap.key.id}}/{% else %}/images/blankicon.ico{% endif %}"/>
                  <a href="{{scrap.content}}">{{scrap.content}}</a>
                {% else %}
                  <span class="scrap_content">{{scrap.content}}<span>
                {% endifequal %}
                <span class="scrap_created">{{scrap.created|timesince}} ago</span>
              </div>
              {% endfor %}
              {% if project.remainder %}
              <div class="scrap_remainder">
                <a href="/project/{{project.id}}/">({{project.remainder}} more)</a>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </body>
</html>